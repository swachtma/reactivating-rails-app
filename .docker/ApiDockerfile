FROM ruby:2.5.1

# Install cmake for a gemfile dependency
RUN apt-get update && \
apt-get install -y cmake && \
gem install rails -v 5.2.0 && \
rails new /app_lock/rr_api --api --database=postgresql --skip-bundle --skip-git

# Overwrite stored database config with docker settings 
COPY ./.docker/init_database.yml /app_lock/rr_api/config/database.yml

# Set working directory to API root, so bash CMD override starts in rails context.
WORKDIR /root/api

# Copy startup script to container root and set as entrypoint
COPY ./.docker/api-entry.sh /api-entry.sh
RUN chmod +x /api-entry.sh
ENTRYPOINT [ "/api-entry.sh" ]

CMD ["bash"]